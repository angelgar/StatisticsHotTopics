---
title: "StatHotTopics"
author: "Angel Garcia de la Garza"
date: "11/20/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries}

library(rvest)
library(stringr)
library(plyr)
library(dplyr)
library(tidyverse)
library(janitor)



```

```{r year_volume, cache = TRUE}

url <- "http://www.tandfonline.com/loi/uasa20"

h = read_html(url)

volume_year = h %>%
    html_nodes(".volume_link h3") %>%
    html_text()

list_volume_year = str_split(volume_year, pattern = " ") 

data_volume_year = matrix(data = unlist(list_volume_year), nrow = 75, ncol = 112) %>%
                    t() %>%
                    .[, which(.[1,] == "Volume"):(which(.[1,] == "Volume") + 2)] %>%
                    as.data.frame() %>%
                    as.tbl() %>%
                    separate(V3, into = c("Year", "remove"), sep = "\n") %>%
                    separate(Year, into = c("Year", "remove2"), sep = "-") %>%
                    mutate(Year = pmax(Year, remove2, na.rm = T),
                           Volume = as.character(V2)) %>%
                    select(-remove, -remove2, -V1, -V2)
  
```

```{r issue_volume, cache = TRUE}

issue.year <- data_volume_year$Year[1]
issue.volume <- data_volume_year$Volume[1]

read_issues <- function(issue.year, issue.volume) {
  
  url <- str_c("http://www.tandfonline.com/loi/uasa20?open=",issue.volume,"&year=",issue.year,"&repitition")

  h = read_html(url)
  
  issue_list = h %>%
    html_nodes(".issue-num") %>%
    html_text() %>% str_split(pattern = "Issue") %>%
    unlist() %>%
    .[which(.  != "")]
  
  data_frame(Volume = rep(as.character(issue[2]), length(issue_list)), Issue = issue_list)
             
}

issues_volume_2 <- map2_df(data_volume_year$Year, data_volume_year$Volume, ~read_issues(.x,.y))

```


```{r write_data}

#write_csv(data_volume_year, "./data_volume_year.csv")
#write_csv(issues_volume, "./data_issues_volume.csv")

```


```{r issue_articles, cache = TRUE}

url <- "http://www.tandfonline.com/toc/uasa20/108/502?nav=tocList"

read_page_reviews <- function(url) {
  
  h = read_html(url)
  
  title = h %>%
    html_nodes(".hlFld-Title") %>%
    html_text() %>% 
    as.data.frame() %>%
    rename(title = ".")
  
  
  views = h %>%
    html_nodes("li:nth-child(1) span") %>%
    html_text() %>% 
    as.data.frame() %>% 
    rename(views = ".")
  
  
  citations = h %>%
    html_nodes("li:nth-child(2) span") %>%
    html_text() %>% 
    as.data.frame() %>% 
    rename(citations = ".")
  
  title_views_citations = cbind(title, views, citations) %>% 
    filter(title != "Book Reviews")
  
  authors = h %>%
    html_nodes(".all") %>%
    html_text()
  
title_views_citations = merge(title_views_citations, authors) %>% 
  as.data.frame() %>% 
  rename(authors = y)
  
}

```

```{r write data}

write_csv(title_views_citations, "./title_views_citations.csv")

```

